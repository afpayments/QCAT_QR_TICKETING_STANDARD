:internal:
:classification-label: For External Distribution
ifdef::internal[]
:classification-label: For Internal Use Only
endif::[]
= QR Code Standard for Transport Ticketing - Standard
:author: AF Payments, Ingo Noka
:revnumber: 1.0_RC1
:revdate: Sept 11, 2019
:doctype: article
:title-page:
:encoding:  utf-8
:lang:      en
:toc:       left
:toclevels: 4
:toc-title: Table of Content
:sectnums:
:sectnumlevels: 4
:last-update-label:
:nofooter!:
:media:     print
:icons:  font
:pagenums:
// Images directory
:imagesdir: images/
:numbered:
:toc: left
:xrefstyle: full
ifdef::backend-pdf[]
:stem: latexmath
//:title-logo-image: image:beep_logo.png[pdfwidth=40%,width=40%,align=right]
endif::[]

ifndef::includedir[]
:includedir:
endif::[]

ifdef::internal[]
[WARNING]
====
{classification-label}
====
endif::[]

ifndef::internal[]
[NOTE]
====
{classification-label}
====
endif::[]

ifdef::internal[]
:!numbered:
[discrete]
== Revisions
[cols="15%,15%,70%", stripes=none]
|====
|Author|Date|Changes

|Ingo Noka| Nov 11, 2018 | Initial revision

.2+|Ingo Noka .2+| Nov 12, 2018
| Add General Requirements
| Add Definitions and Acronyms section

.6+|Ingo Noka .6+| Nov 13, 2018
| Add a References section
| Add sections on QR encoding rules and format
| Add Inspection Terminal
| Add Copyright section
| Add default signature algorithm SHA512 with RSA
| Add signature algorithm version number in signature field

|Ingo Noka | Nov 14, 2018
| Fixed copyright year

.2+|Ingo Noka .2+| Jan 5, 2019
|Add Effective Time
|Add Seat Number

.2+|Ingo Noka .2+| Jan 20, 2019
|Add Seat class
|Change order of fields and bring tag numbers in ascending order

.1+|Ingo Noka .1+| Jan 20, 2019
|Remove sample QR codes, which are now in a separate document

.1+|Ingo Noka .1+| Jan 25, 2019
|Change effective time from period type to timestamp type

.1+|Ingo Noka .1+| Feb 27, 2019
|Add signature key identifier

.4+|Ingo Noka .4+| April 4, 2019
|clarify the use of account data for post-paid tickets
|add algorithm version 2: SHA1withECDSA
|clarify treatment of expiry period at exit terminal
|add references to key management and settlement documents

.1+|Ingo Noka .1+|April 6, 2019
|clarify the use of ticket id and account information for pre-paid and post
paid tickets

.1+|Ingo Noka .1+|April 12, 2019
|Fix tag number for signature key identifier field

.1+|Ingo Noka .1+|April 19, 2019
|Align ticket type numbers with beep profile IDs

.1+|Ingo Noka .1+|June 11, 2019
|Add proprietary ticket type numbers for Topline Marina


.3+|Ingo Noka .3+|Aug 8, 2019
|Add terminal ID to list of QR fields
|Add version number `0x02` to ESDSA default algorithm
|Correct spelling mistakes

.3+|Ingo Noka .3+|Sept 9, 2019
|Add Appendix with QCAT System Roles
|Change all references to actors in the system to the terms defined in the new Appendix
|Change the format of the fields section (add room for TLV sample values)

.2+|Ingo Noka .2+|Sept 11, 2019
|Add sample data from automatically generated data
|Update generated sample data and change directory structure

|====

.To Do
****
. Extract risk management remarks and create a separate risk management document
. Update the processing rules to take into account new data
****


endif::[]

:numbered:

== Introduction
This specification outlines the concepts of a QR code based ticketing system for automated fare collection in public transport.

The specification for the QR payload follows the EMVCo standard framework without using any of the optional data elements that the EMVCo standard introduces to support retail payment transactions.

Following the EMVCo standard also provides flexibility for ticket issuers and QCAT Ticket Acceptors to define additional data and standards.


== General Requirements and Features

. The standard meets the EMV QR Code Specification for Payment Systems (EMV QRCPS) - Consumer Presented Mode, including
.. Base64 encoded payload
.. Use of BER-TLV encoded data
.. Presence of all mandatory EMV data elements, including:
... Payload format indicator,
... at least one application template and
.. Use of the EMV application specific transparent template for ticket specific data
.. maximum of 512 bytes payload (same as EMVCo requirement)
.. EMVCo Processing rules apply in the sense that
... the validation terminal QR Code reader recognizes QR codes that meet the parameters of the EMV specification
... the POI Application parses the QR code payload according to EMV specifications
... the POS application uses proprietary data element included in the Application Specific Transparent Template for processing that is independent of the EMV specification
... an EMV compliant payment terminal should be able to recognize read the QR code, but ultimately rejects it unless it has been programmed to support QCAT in addition to payment applications


. The standard supports both pre-paid tickets and post-paid tickets
. The standard supports offline mode of the ticket validator, but in case of mobile phone based ticketing requires the passenger's phone to be online at the time of transaction

. Supports two modes of fare calculation:
.. scan-in/scan-out mode of operation with fare calculation based on distance or stop/station information
.. scan-in with fixed fee fare
+
.Note
****
Even if the QR code changes while the passenger is traveling, it must be possible to link the scan-in and scan-out data records to determine the distance the passenger has travelled and therefore the fare to be paid.  In this specification the ticket number and the account information will be used for this purpose:

* If no account data is present, the ticket ID is used
* If account data is present, the account information is used.

This means that implementers of this standard on the ticket creation side, need to ensure that either the ticket ID remains the same until the customer taps out or the account information is populated if the ticket ID changes in between tapping in and out.
****
.. fixed single fare operation
. The standard supports special fare calculation rules (for example discounts for concessionary cardholders)
+
.Note
****
The process of verifying whether a passenger is eligible for a particular discount before a discounted ticket is issued is out of scope of this specification
****

. The standard supports interoperability of multiple QCAT Ticket issuers, QCAT Ticket Acceptors, and transport operators
. The standard supports QCAT Ticket Creators/Sellers to generate QR tickets on behalf of the QCAT Ticket Issuer
. The standard supports cryptographic validation of ticket data by the ticket validation terminal in offline mode
. The standard includes two standard ticket signature algorithms, but is open for additional algorithms for ticket signature creation and validation
. The standard supports expiry period for tickets and refresh of QR codes for the same ticket to reduce risk of fraudulent QR code copying
. The standard supports reconciliation, clearing and settlement between independent parties


[CAUTION]
The standard provides the necessary data for reconciliation, clearing and settlement, but the actual processes reconciling, clearing and settling transactions between QCAT Ticket Issuers, Funding Providers, QCAT Ticket Acceptors and Public Transport Operators is out of scope of this specification.  There is a separate document which details the flow of funds for pre-paid and post-paid transactions.

== Use Cases

=== Payment vs. Ticketing

The use cases are build on the assumption that in Automated Fare Collection, payment and ticketing are two distinct processes.

The ticket validator terminals usually only validate a ticket and collect enough information to create a settlement record.

The ticket itself is either paid upfront or after the passenger completed their journey

////
Conceptually, this is also true for offline stored value cards where the ticket validation and payment transaction happen at the same time, but constitute two different processes.
////

=== Use case: Passenger Presented Prepaid QR Code Ticket

. The Prepaid QR Code ticket can be printed on paper or generated and displayed on the phone

. The passenger pays for the ticket before starting the journey. There are many possible payment scenarios, such as
.. The passenger uses an application to generate a prepaid QR code ticket on the phone.  The payment can be done through an electronic payment transaction from e-Wallets, bank accounts or card transactions
.. The passenger presents a QR code generated by an e-Wallet provider or a bank to a special unattended terminal, which will use the QR code to seek authorization for the fare amount and then prints a pre-paid ticket.
.. The passenger uses cash to buy a paper ticket at an attended ticketing booth

. The prepaid ticket may contain the price, the boarding station, the destination station, validity period and so forth.

. In all cases the passenger presents the prepaid ticket to the ticket validator terminal at the boarding gate or entry to the paid area

. The ticket validator verifies the validity of the ticket at the entry and possibly at the exit station

. The QCAT Ticket Acceptor and the ticket seller will settle transactions based on ticket validation reports.

.Notes
****
* All QR prepaid tickets should contain information about the boarding and exit station.  It should only be valid for travel between these two stations. Not including this data means that in most cases the QCAT Ticket Issuer will be liable for fraudulent transactions.
+
If the boarding station is included in the ticket data, it will be possible to prevent most cases of fraudulent copying of QR codes by synchronizing the validators in that station. A network connection to a central system is not needed as a station computer or point-to-point connections between validators would be enough.
* If the exit station is also included in the ticket data, if the passenger exits at a station that is not the station for which the QR ticket was generated, then the passenger will be asked to pay the shortfall in cash (similar to Single Journey Ticket process currently in place at the three train lines in Manila)
****

=== Use case: Passenger Presented Post-Paid QR Code Ticket

. The QCAT Ticket Issuer, at the request of the passenger, generates a QR code on the mobile phone that contains information about the account or identity of the passenger
. The QCAT Ticket Issuer potentially earmarks a certain amount in the passenger's account.
. The entry and exit QR Validator Terminals verify the QR code and open the gate if the QR data is valid
. The QR Validator Terminals send the QR validation records (entry and exit) to the QCAT Ticket Acceptor as soon as possible
. The QCAT Ticket Acceptor calculates the ticket price based on entry and exit station and generates a payment transaction including the amount and the QR code account or identity data.  The payment transaction record is sent to the QCAT Ticket Issuer who debits the passenger's account based on the data included in the payment transaction record.

.Notes
****
. Post-paid tickets should also contain the boarding station to limit the risk of tickets being copied and used fraudulently.  If the boarding station is included in the ticket data, the gates in the boarding station can verify whether the same QR code has already been used.
. In most cases the QCAT Ticket Issuer caries the risk of at least one ticket not being paid for by the customer, before the account can be closed for additional ticketing transactions
. The risk can be reduced by earmarking a certain amount in the customer's account at the time of ticket generation, but this introduces many complexities, such as management of tickets that are not used or earmarked amounts that exceed the value of the ticketing transactions.
. The risk can also be reduced by including a maximum authorized amount in the QR code data, which could reduce the risk in public transport operations in which tickets can have large variations.
****

== Ticket vs QR Code

Ticket and QR code have different identities because they can have independent expiry periods, which means that the QR code can expire earlier than the ticket.  For example, a ticket that is valid for 30 minutes may be represented by a QR code that is refreshed every 30 seconds.

Paper-based tickets only have one expiry time for both ticket and QR code, while mobile phone based tickets may frequently recreate the QR code to reduce the risk of fraudulent use of copied QR codes.

== Ticket ID vs Account Information

Tickets always contain a Ticket ID and may optionally contain account information.  The Ticket ID identifies the ticket, while the account information identifies the passenger or the passenger's funding source.


=== Pre-Paid Tickets

For pre-paid tickets the ticket ID will always be unique, that is a ticket creator must never create two pre-paid tickets with the same ticket ID.  Ticket IDs are unique only in combination with additional data:

* if the ticket ID is managed centrally, then the ticket ID will be unique in combination with the participant ID of the QCAT Ticket Issuer
* if the ticket is managed decentralized, for example by offline issuing terminals, then the Ticket ID will be unique in combination with the terminal ID.

For tickets created offline, the ticket ID should include a terminal identifier, which should be unique across the entire terminal fleet of the ticket creator.

It may be helpful to ensure that the ticket ID cannot be reset and increments for each successful ticket issuance.

The account information is not necessary for the settlement, but can be included to identify the payment instrument that was used to pay for the ticket and therefore supports the ticket issuer's reconciliation process with the funding provider.

=== Post Paid Tickets

For post-paid tickets the account information is mandatory.  It is used to identify the payment instrument and funding source that will be charged for the ticket.  In other words, the ticket issuer or funding provider will use the account information to identify the customer and customer funding account for the payment of the ticket.

The ticket ID may be different in the entry and exit record for a single trip.  This is because the customer may close the mobile application while traveling and therefore needs to create a new QR code before passing through the exit gate. The ticket creator does not know whether the customer has already passed the exit gate and has moved on to the next means of transport.  Therefore, the QR code will usually contain a new ticket ID.

ifdef::internal[]
.Heuristic for Matching Entry And Exit Records
****
The backend system will use the following heuristic to link an entry transaction A to an exit record:

. Find an exit transaction B with the same ticket ID
.. if found, check whether there is an entry transaction C with transaction time between A and B
... if yes, raise an *exception*
... if no take B as matching exit transaction for A
. Find an exit transaction D with the same account information
.. if found check whether there is an entry transaction E with transaction time between A and D
... if yes, raise an *exception*
... if no, take E as matching exit transaction for A
. If no matching exit transaction found, raise an *exception*
****
endif::[]

== Ticket Validity Domains

The ticket validity domain provides a means to limit acceptance of QR tickets to groups of transport providers. For example a ticket may only be valid on operators of light rail systems in Manila.

This specification defines standard domains, but QCAT Ticket Acceptors may define additional domains, in which case QCAT Ticket Acceptor and QCAT Ticket Issuer  must agree which Transport Operators will be included in a particular validity domain.

IMPORTANT: Additional domains must be registered with the QCAT Registrar

The ticket may contain multiple ticket domains.  The domains should be mutually exclusive, but if they are not then the largest possible domain combination will be used.

For example if both standard domains `1` and `2` are contained in the QR code, then the ticket will be valid on all light rail systems and not just in LRT1.  If domains `2` and `3` are included then the ticket is valid in LRT1 and LRT2, but not in MRT3 or any other public transport domain.

QCAT Ticket Acceptor specific domains must be unique in the context of that QCAT Ticket Acceptor.

.Standard Ticket Domains
[cols="30,70"]
|====
|Identifier|Domain

|0|All forms of public transport.  No restrictions.
|1|All light rail systems
|2|LRT1 only
|3|LRT2 only
|4|MRT3 only
|5|All non-rail public transport
|6|All buses
|7|All Jeepneys
|8 ... 0x7FFF| reserved
|0x8000 ... 0xFFFF| QCAT Ticket Acceptor specific domains
|====

== Ticket Types
The ticket type indicate special processing rules, such as application of discounts or transit pass.

This specification defines standard ticket types, but QCAT Ticket Acceptors may define proprietary types as well.

IMPORTANT: Additional ticket types must be registered with the QCAT Registrar

A QR code can contain more than one type.

Proprietary ticket types must be unique within the context of one QCAT Ticket Acceptor.In other words, the ticket type must have the same meaning in all transport operators (defined by validity domain or transport operator IDs) in which the ticket is valid.This also means that if the default validity domain for "All forms of public transport" is included, only standard ticket types should be used.

Validation terminals that do not recognize a proprietary ticket type should ignore it.

.Standard Ticket Types
[cols="30,70"]
|====
|Identifier|Type

|0|Reserved
|1|Standard
|2|Senior Citizen
|3|PWD
|4|LRT1 Employee Card
|5|LRT2 Employee Card
|6|MRT3 Employee Card
|7|AFCS Employee Card
|8 ... 16|Reserved
|17|Student
|18 ... 0x7FFF|Reserved
|0x8000 ... 0xFFFF|QR issuer specific types
|====

=== Proprietary Ticket Type Definitions

ifdef::internal[]

[WARNING]
====
{classification-label}
====


.PTO/Terminal specific Ticket Types
[cols="20,30,50"]
|====
|Participant ID|Identifier|Type

.5+|328 (Topline)
|32768|Children (4-12)
|32769|Children (3 below)
|32770|CTU
|32771|MEPZ
|32772|Tourist
|====

endif::[]

ifndef::internal[]
[NOTE]
====
Contact AF Payments Inc, for a list of proprietary ticket types.
====
endif::[]

== Funding Source Types
The funding source types define the type of funding source that was used to pay for the ticket.

IMPORTANT: Additional funding source types must be registered with the QCAT Registrar. This specification does not allow proprietary funding source types.

Validation terminals should not reject tickets that contain an unknown funding source type.

If the funding source type is unknown, then the QR code smusthould not include a funding source type field.

.Funding Source Types
[cols="20,20,60"]
|====
|Identifier|Type|Description

|0|Reserved|
|1|Cash|The ticket was paid for with cash (passenger present)
|2|Bank card, card present|The ticket was paid for with a banking card, which could be a Credit, Debit or proprietary bank card (cardholder and card present, i.e. face-to-face transactions)
|3|Bank card, card not present|The ticket was paid for with a banking card, which could be a Credit, Debit or proprietary bank card (cardholder and/or card not present, i.e. online transactions)
|4|E-Wallet, customer present|The ticket was paid for with funds coming out of an online e-wallet application. The customer is present at the point of sales transaction.  Typically, the customer uses a mobile application to scan or generate a payment QR code while physically present at a ticket sales booth or while interacting with a conductor.
|5|E-Wallet, customer not present|The ticket was paid for with funds coming out of an online e-wallet application. The customer uses a mobile phone application directly to pay and generate the QR ticket. There is no interaction with a sales clerk at a ticketing booth or with a conductor.
|6|Bank account|The ticket was paid for with funds directly debited from a bank account. (usually online transactions only)
|7|Transpo|The ticket was paid for with the stored value coming from a Transpo(TM) compliant card.
|8|CASH-PAID | The ticket was paid for with cash (passenger present) in advanced or scheduled trip.
|8-0xFFFF|Reserved|
|====

== Funding Source Provider
The meaning of the value in the funding source provider field is defined based on the type of funding source.

.Funding Source Provider
[cols="10,20,60"]
|====
2+|Funding Source Type|Values

|0|Reserved|
|1|Cash|No Funding source provider allowed.
|2|Bank card, card present|The bank card BIN.
|3|Bank card, card not present|The bank card BIN.
|4|E-Wallet, customer present|Participant ID as defined by the QCAT Registrar
|5|E-Wallet, customer not present|Participant ID as defined by the QCAT Registrar
|6|Bank account|SWIFT code
|7|Transpo|Issuer ID or participant ID as defined by the QCAT Registrar
|8|CASH-PAID |No Funding source provider allowed.
|7-0xFFFF|Reserved|
|====


== QR Ticket Format

=== QR Ticket Encoding

. The QR Code is encoded as defined in Section 3.2 of <<emv-qr-spec-consumer,EMV Customer Presented QR Specification>>

. The QR ticket data is encoded according to ASN.1 and BER encoding rules.  This means that each field in the ticket data is encoded with a Tag, a length and a value.  the tag identifies the field, the length provides the number of bytes in the value and the value carries the actual content of the field.

. Because of the BER format, fields can
.. appear in any order,
.. appear multiple times and
.. be omitted if not needed

. All QCAT field tags are in the Private class and of Primitive type.

. If the value of the TLV data object has a length of less than `128` bytes, then the length must be encoded in one byte, for example a length of `127` is encoded as
+
[source]
----
7F
----

. If the value of the TLV data object has a length of `128` to `255` bytes, then the length must be encoded in two bytes, and if the length is bigger then `255`, in three bytes,  for example a length of `255` is encoded as
+
[source]
----
81 FF
----
+
And a length of `500` is encoded as
+
[source]
----
82 01 F4
----

. The first TLV object in the QR payload data is always the Payload Format Indicator (tag `0x85`) with a fixed value length of 5 bytes.  In this specification the value must be `CPV01`.  This convention is a requirement of the EMV specification.
+
[source]
----
85 05 43 50 56 30 31
----
. This means the base64 data encoded in the QR code must always start with "`hQVDUFY`".  Using this string, the validator terminal can identify QR codes that are candidates for QCAT tickets

. The second TLV object must be an Application Template (tag `0x61`), which contains an Application Specific Transparent Template (tag `0x63`),

. The ADF name of the Application Template (tag `4F`) must be included as the first data object and for this version of the specification must contain the value `QCAT01`, i.e.
+
[source]
----
4F 06 51 43 41 54 30 31
----

. The Application Template may contain EMV specified data objects for proprietary processing purposes. These data objects will be ignored by the validation terminal.

. The Application Template must contain an Application Specific Transparent Template (tag `0x63`) which must only contain  TLV data objects defined in <<QR Code Fields>>.

. Except for the ADF name, which is always the first data object, and the signature, which is always the last data object, all other data objects in the Application Specific Transparent Template may appear in any order.

. Some data objects may appear multiple times.  If a data object is included multiple times, the POI application creates a list of objects, i.e. each appearance is significant.  For example the Ticket Validity Domain may appear multiple times which means that the ticket is valid in all the included domains.

. The QR code may contain further Application Templates, which are outside the scope of this specification.  The EMV standard size limitation applies to the total of all the data in the QR code.

.Sample of a valid TLV structure of a QCAT ticket
include::{includedir}samples/qr-samples-max.adoc[tags=tlv]


=== QR Code Fields

In the following field definitions O means Optional, C means Conditional and M means Mandatory.

// ---------------------- Mandatory Fields ----------------------------------------

==== Mandatory Fields

===== Ticket Identifier
The ticket identifier is unique in combination with either the time of creation and the ticket issuer id or in combination with the Terminal Identifier.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag |Format  |Default |Sample Value |TLV Sample

|1
|Unsigned Integer,  +
32 bit
|N/A
|`644382`
|`C10309D51E`
|====

// --------------------------------------------------------------------------------
===== Ticket Creator ID
The ticket creator is the organization that is authorized to create tickets and that will be liable for the fare amount when a QCAT Ticket Acceptor accepted the ticket.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 2
|Unsigned Integer,  +
16 bit
|N/A |
include::{includedir}samples/tlv-list-max.adoc[tags=C2-value]
|
include::{includedir}samples/tlv-list-max.adoc[tags=C2]
|====

// --------------------------------------------------------------------------------
===== Ticket Creation Time
Time at which the QCAT Ticket Issuer created the ticket. The validation terminal will calculate the expiry time with this time as the base unless there is an effective time included in the ticket data.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 3 |Timestamp
| N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=C3-value]
// `2019-04-06T17:12:53+08:00` => `1538028205` => *`5CA86D95`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=C3]
|====

// --------------------------------------------------------------------------------
===== Ticket Validity Period
Time period in seconds after which the ticket is not valid anymore. Validation terminals must calculate the expiry time as follows:

[code]
----
if( "effective time" is present )
    "effective time" + "validity period"
else
    "creation time" + "validity period"
----

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 4
|Unsigned Integer,  +
32 bit
|15m => 900s => *`0x0384`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=C4-value]
// 24h => 86,400s => *`015180`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=C4]

|====

==== Optional Fields
// ---------------------- Optional Fields -----------------------------------------
===== Ticket Validity Domain
Identifies the public transport domain in which the ticket is valid. Ticket Validity Domain identifiers are assigned by the ticket issuer and are unique only in combination with the ticket creator ID

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 5
|Unsigned Integer,  +
16 bit
|`0` (All)
|
include::{includedir}samples/tlv-list-max.adoc[tags=C5-value]
// `1` (Rail only)
|
include::{includedir}samples/tlv-list-max.adoc[tags=C5]

|====
// --------------------------------------------------------------------------------
===== Transport Operator ID
The identifier of transport operator for which the ticket is valid. There could be more than one Transport Operator ID in the QR code.  Operators can be grouped and assigned a Ticket Validity Domain to avoid including too many operator IDs.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 6
|Unsigned Integer,  +
32 bit
| all operators
|
include::{includedir}samples/tlv-list-max.adoc[tags=C6-value]
// 4,095 => *`FFF`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=C6]

|====
// --------------------------------------------------------------------------------
===== Ticket Effective Time
Time after which the ticket is valid. Default is the ticket creation time. If the effective time is included in the ticket data, then the expiry time is calculated by adding the expiry period to this effective time.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 7
|Timestamp
| 0 (Immediate)
|
include::{includedir}samples/tlv-list-max.adoc[tags=C7-value]
// Ticket is valid from Monday, 28 2019 at 6 am => the equivalent UTC time is "Sun Jan 27 22:00:00 UTC 2019" => `1548626400` => *`5C4E29E0`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=C7]

|====

// --------------------------------------------------------------------------------
===== Refresh Time
Time after which the ticket need to be refreshed with a new refresh time and signature. A value of `0` or if the field is not included means that the QR ticket is static.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

|8
|Timestamp
|0 (static)
|
include::{includedir}samples/tlv-list-max.adoc[tags=C8-value]
// Ticket will not be accepted unless refreshed with a new refresh time after Monday, 28 2019 at 06:00:30 am => the equivalent UTC time is "Sun Jan 27 22:00:30 UTC 2019" => `1548626430` => *`5C4E29FE`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=C8]


|====
// --------------------------------------------------------------------------------
===== Ticket type
Indicates a special processing rule that will be applied when calculating the fare.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

|9
|Unsigned Integer,  +
16 bit
|1 (Standard)
|
include::{includedir}samples/tlv-list-max.adoc[tags=C9-value]
// 2 (Senior Citizen)
|
include::{includedir}samples/tlv-list-max.adoc[tags=C9]

|====

// --------------------------------------------------------------------------------
===== Account identifier
The account identifier provides information about the passenger's account with the funding provider.  This account will be debited according to the fare table and ticketing rules. The account number may actually be created as a token that is valid only for a certain time or for a certain transaction.  Backend system should therefore not rely on this identifier to group transactions. Must be present in post-paid tickets

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

|10
|ASCII +
Excl. Control Characters
|N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=CA-value]
// id "A-4095" => *`0x41 0x2d 0x34 0x30 0x39 0x35`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=CA]

|====

// --------------------------------------------------------------------------------
===== Boarding Station
The identifier of the boarding station or stop for which the ticket is valid.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

|11
|Unsigned Integer,  +
32 bit
| Any boarding station
|
include::{includedir}samples/tlv-list-max.adoc[tags=CB-value]
// 1
|
include::{includedir}samples/tlv-list-max.adoc[tags=CB]

|====
// --------------------------------------------------------------------------------

===== Destination Station
The identifier of the destination station or stop to which the ticket is valid.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

|12
|Unsigned Integer,  +
32 bit
|N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=CC-value]
// id 4,095 => *`0FFF`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=CC]

|====

// --------------------------------------------------------------------------------

===== Vehicle ID
The identifier of the vehicle for which the ticket is valid (e.g bus number).

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

|13
|Unsigned Integer,  +
32 bit
|N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=CD-value]
// id 4,095 => *`0FFF`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=CD]

|====

// --------------------------------------------------------------------------------

===== Route ID
The id of the route for which the ticket is valid (e.g bus number).

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

|14
|Unsigned Integer,  +
32 bit
|N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=CE-value]
// id 4,095 => *`0FFF`*
|
include::{includedir}samples/tlv-list-max.adoc[tags=CE]

|====

// --------------------------------------------------------------------------------
===== Seat Number
The identifier for a particular seat that has been reserved for the passenger presenting this ticket.  The format and meaning is operator or QCAT Ticket Acceptor specific.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 15
| ASCII max 5 characters
|N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=CF-value]
// "3D"
|
include::{includedir}samples/tlv-list-max.adoc[tags=CF]

|====
// --------------------------------------------------------------------------------
===== Seat Class
The identifier for a particular seat class.  The format and meaning is operator or QCAT Ticket Acceptor specific.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 16
| ASCII, max 5 characters
|N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=D0-value]
// "ECOP" Economy Premium, "BUS" Business Class
|
include::{includedir}samples/tlv-list-max.adoc[tags=D0]

|====
// --------------------------------------------------------------------------------
===== Maximum Authorized Amount
Amount in Centavos.  If the fare amount is known when the passenger starts the trip, this field will be checked and the QR code rejected if the fare is higher than the maximum authorized amount.  If the fare is not known at boarding time, the maximum remaining fare on the trip must be lower than the amount in this field.  The funding provider may earmark this amount in the passengers account and release the unused funds when the correct fare amount is provided by the QCAT Ticket Acceptor.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

|17
|Unsigned Integer,  +
32 bit
| 0 (Unlimited)
|
include::{includedir}samples/tlv-list-max.adoc[tags=D1-value]
// 2000 (PHP 20)
|
include::{includedir}samples/tlv-list-max.adoc[tags=D1]

|====
// --------------------------------------------------------------------------------
===== Signature Key Identifier
The key identifier is used to distinguish multiple public key certificates assigned to a single QCAT Ticket Issuer.  It corresponds to the Common Name (CN) in the Issuer's certificate.  If present, the value in this field and the CN of the QCAT Ticket Issuer certificate that is used to validate the signature must match.  If this field is not present, the terminal will ignore the CN and use any certificate with the Creator ID.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 18
| ASCII `[0-9a-zA-Z_-]`
| Use first matching public key for Creator Id
|
include::{includedir}samples/tlv-list-max.adoc[tags=D2-value]
// BPI BACKEND
|
include::{includedir}samples/tlv-list-max.adoc[tags=D2]

|====
// --------------------------------------------------------------------------------
===== Terminal Identifier
The terminal identifier identifies the device that "produced" the QCAT ticket.  Validation terminals should always check the terminal ID, if present, together with the ticket ID and creation time to ensure that the same ticket is not used twice. The terminal ID should be unique in the ticket creator fleet of devices to the extend that the validation terminal is able to distinguish between two tickets with the same ticket identifier.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 19
| ASCII `[0-9a-zA-Z_-]`
| N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=D3-value]
// `1352701060268304`
|
include::{includedir}samples/tlv-list-max.adoc[tags=D3]
|====

// --------------------------------------------------------------------------------
===== Funding Source Type
The funding source type identifies the type of funding source that was used to pay for the ticket. Depending on the funding source type, the account identifier can be used to provide more details on the funding source.  For example if the funding source type is "Transpo card" then the account identifier could contain the CAN of the transpo card.

NOTE: The type of funding source is not the same as the organization providing the funding.  For example, Gcash is the funding provider while E-Wallet is the type of funding source.

A QR code should only contain one funding source type. It is undefined which funding source type the terminal will choose if the ticket contains multiple funding source types.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 20
| Unsigned Integer,
32 bit
| N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=D4-value]
// `1352701060268304`
|
include::{includedir}samples/tlv-list-max.adoc[tags=D4]


|====

===== Funding Source Provider
The participant ID of the funding source provider. The meaning of the value in this field depends on the funding source type.  For example, if the funding source type is a bank card, then the value would represent a BIN, in case of a Transpo(TM) card, the value may represent the IIN of the stored value card. See <<Funding Source Provider>> for the meaning of this field.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 21
| ASCII `[0-9a-zA-Z_-]`
| N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=D5-value]
// `1352701060268304`
|
include::{includedir}samples/tlv-list-max.adoc[tags=D5]
|====

TIP: If the ticket contains an account identifier, and the account identifier contains the funding source provider, e.g., the BIN in a credit card number, then the QR Code should contain a funding source provider field.

// --------------------------------------------------------------------------------
===== Signature
The signature proves that the the QR code was indeed created by the QCAT Ticket Issuer. The signature is calculated according to the algorithm that is described in this specification. The first byte contains a version number and the remaining bytes contain the signature value. Version numbers from `0x00 ... 0x7F` are reserved for this specification. Version number `0x80 ... 0xFF` can be used for proprietary algorithms.

[width="100%",cols="10,25,15,30,30"]
|====
|Tag|Format|Default|Sample Value|TLV Sample

| 30
| binary
| N/A
|
include::{includedir}samples/tlv-list-max.adoc[tags=DE-value]
// 0x01 ...
|
include::{includedir}samples/tlv-list-max.adoc[tags=DE]

|====

==== Unique Identifiers

All identifiers such as vehicle ID, route ID, destination or boarding station are only unique in combination with the operator ID.  Therefore at least one operator id must be present if any of these fields are included.

=== Data Formats

==== Unsigned Integers

Unsigned integer numbers are always binary encoded in the smallest possible number of bytes in big endian byte order. For example `255` is encoded in one byte `0xFF` and `65535` is encoded in two bytes `0xFF 0xFF`.

This standard only uses unsigned Integers in the QR code payload.

Other than in the BER rules for the encoding of Integers the encoded number must not use leading zeros for values that have the left most bit set to 1.

For example, according to BER rules, integer value 128 (0x80) need to be encoded as `0x00 0x80` to distinguish 128 from -127.  Since negative numbers are not allowed the leading `0x00` becomes redundant and 28 is encoded in one byte `0x80`.

==== Timestamps

Timestamps are encoded as unsigned integer, encoded binary in 4 bytes. A timestamps represents the number of seconds since 1970-01-01 00:00:00 UTC.

For example, `Tue Nov 13 13:16:17 +08 2018` is encoded as `1542086177`, i.e. `0x5B 0xEA 0x5E 0x21`

Four bytes will overflow at `Sun Feb  7 06:28:15 UTC 2106`

ifdef::internal[]

.Bash command to show the maximum timestamp that can be expressed in a four byte unsigned integer
[source]
----
gdate -d @$(( 0xFFFFFFFF )) -u
----
endif::[]

====  Dates

Dates are encoded as unsigned integer, binary encoded in 2 bytes. A date represents the number of days since 1970-01-01.

For example, `Tue Nov 13, 2018` is represented as `17848`, i.e. `0x45 0xB8`

Two bytes will overflow on Jun 6, 2149

ifdef::internal[]

.Bash command to show the maximum date that can be expressed in a two byte unsigned integer
[source]
----
gdate -d @$(( 0xFFFF * 24 * 60 * 60 )
----
endif::[]


== Signature

=== Signature Algorithm

This specification defines two default algorithms. The QCAT Certificate Authority in coordination with QCAT Ticket Issuers and QCAT Ticket Acceptors may introduce new algorithms.

IMPORTANT: Additional algorithms must be registered with the QCAT Registrar

Signature algorithms should meet the following requirements:

. the validation terminal must be able to verify the signature in offline mode, i.e. without having a connection to the ticket issuer
. supports multiple ticket issuers with different cryptographic credentials
. must fit into the 512 byte limit for the QR data
. must allow detection of unauthorized change of any data in the application template
. only the QCAT Ticket Issuer or entities authorized by the QR issuer must be able to generate a valid signature

=== Signature Validation

The terminal checks whether the cryptographic credentials for the Ticket Creator ID exists and uses the associated credentials to verify the signature.

If the cryptographic credentials do not exist or the signature verification failed, the ticket must be rejected

The terminal must be able to blacklist or delete cryptographic credentials to ensure the terminal only accepts tickets from genuine QCAT Ticket Issuers for which an acceptance agreement exists.

=== Default Signature Algorithms

The default algorithms for creating a ticket signature are

. the SHA512 hash with a RSA signature and keys of length 1024 bits, creating a 128 byte signature. The version number of this algorithm is `0x01`
. the SHA1 hash with a ECDSA signature (Elliptic Curve). The key lengths and therefore the signature length may vary by issuer. The version number of this algorithm is `0x02`

QCAT Ticket Issuers generate a RSA-1024 or ECDSA key pair and request the QCAT Certificate Authority to sign the key with the QCAT Certificate Authority's own RSA-2048 or ECDSA key.

The public keys are distributed to the Validation Terminals in X-509 certificates.

The QCAT Certificate Authority publishes and distributes certificate revocation lists to remove keys from Validator Terminals, for example when a QCAT Ticket Issuer is changing their key or the QCAT Ticket Acceptor does not accept tickets from that issuer anymore.

==== Signature Creation

The QCAT Ticket Issuer generates a SHA512 or SHA1 with RSA or ECDSA signature over the data included in the Application Specific Transparent Template of the QR code and includes the resulting signature in the Application Specific Transparent Template.

The data from the QR code must be used in the exact order they are provided in the QR code.

The signature creation is performed over the raw bytes of the BER encoded data, i.e. before the data is converted to its BASE64 representation.

For example, given the above TLV structure of a ticket the signature would be generated over the following data (bytes in hex):

include::{includedir}samples/qr-samples-max.adoc[tags=signature-data]


==== Signature Validation

The Validation Terminal first removes the signature TLV data object from the Application Specific Transparent Template.  It then applies the SHA512 or SHA1 with RSA or ECDSA signature validation function to the remaining BER encoded data from the QR code.

The data from the QR code must be used in the exact order they are provided in the QR code.

The validation is performed over the raw bytes, i.e. after the data was converted from its BASE64 representation.


== Discounts, Transit Products

For post-paid tickets discounts are applied to the standard fare at the QCAT Acceptor backend system.  The ticket type is an indication to the transport provider, which type of discount will be applied.


== Validation on Entry

. Check whether the ticket effective time is in the past

. Check whether the QR ticket has expired
+
[source,subs="normal"]
----
if (Time^Now^ < (Time^Creation^ + ValidityPeriod))
    "OK"
else
    "FAIL"
----

. Check refresh period <<QR Refresh Period>>

. Check whether the ticket creator id, ticket domain and ticket type is accepted at the terminal.
+
If the QCAT Ticket Acceptor accepts tickets without having a prior acceptance agreement for the particular domain and/or type with the QCAT Ticket Issuer, the QCAT Ticket Issuer may refuse to settle the transaction.

. If present, check whether the Transport Operator Id matches the id of the validator's PTO

. Check whether the maximum authorized amount is higher than the maximum remaining fare or the single fixed fare.  If the ticket is accepted even so the maximum authorized amount is lower than the ticket price, the ticket issuer or funding provider may only settle the maximum authorized amount

. If a boarding station is present in the QR code data, check that the validator's station number is the same as the identifier in the QR code

. If a vehicle number is present in the QR code data check that the validator's vehicle number is the same as the identifier in the QR code.  At the discretion of the QCAT Ticket Acceptor, the vehicle identifier can be ignored, for example if the validator is installed in a gate that provides access to multiple vehicles (e.g bus terminals)

. If a route id is present in the QR code data check that the validator's route number is the same as the identifier in the QR code.  At the discretion of the QCAT Ticket Acceptor, the route identifier can be ignored, for example if the validator is installed in a gate that provides access to multiple vehicles plying different routes (e.g at bus terminals)

. The Validator Terminal must keep a list of already validated QR codes and reject QR code tickets with a Ticket Identifier that has already been used.

. If the Validator Terminal has access to the list of validated QR codes from other Validator Terminals, it should check whether the same QR Ticket Identifier has already been used elsewhere.

. Check the signature <<Signature Validation>>


== Validation on Exit

. Check refresh period <<QR Refresh Period>>

. Check whether the ticket has expired.  Since it is possible that the passenger checked into the paid area shortly before the ticket expires, the exit terminal should add an appropriate period of time to the expiry period accounting for the travel time.

. Furthermore, to avoid refusal of QR codes in case of delays or service disruptions, the exit validator terminal should be able to add a further grace period that is appropriate for the delay or service disruption.

. If the destination station is present in the QR code data, check whether the validator's station id is the same as the destination station in the QR code data

. The Validator Terminal must keep a list of already validated QR codes and reject QR code tickets with a Ticket Identifier that has already been used.

. If the Validator Terminal has access to the list of validated QR codes from other Validator Terminals, it should check whether the same QR Ticket Identifier has already been used elsewhere.

. Check the signature <<Signature Validation>>

== Validation on Inspection Terminals

. Check refresh period <<QR Refresh Period>>

. Check whether the ticket has expired.
+
 Since it is possible that the passenger checked into the paid area shortly before the ticket expires, the exit terminal should add an appropriate period of time to the expiry period accounting for the travel time. To avoid refusal of QR codes in case of delays or service disruptions, the Inspection Terminal should allow an additional grace period that is appropriate for the delay or disruption.

. If the destination station is present in the QR code data, check whether the vehicle has already passed the destination station.

. The Inspection Terminal should store already verified tickets and check whether the same ticket ID appears multiple times.

. If a vehicle number is present in the QR code data check that the validator's vehicle number is the same as the identifier in the QR code.

. If a route id is present in the QR code data check that the validator's route number is the same as the identifier in the QR code.

. Check the signature <<Signature Validation>>

== QR Refresh Period

The QR code may be refreshed in regular intervals as indicated in the `Refresh Time` field. If this field is present and not `0`, then the QR code is only valid if the current time is earlier then the refresh time.

[source,subs="normal"]
----
if (Time^Now^ < RefreshTime + GracePeriod)
    "OK"
else
    "FAIL"
----

To avoid rejections of valid QR codes, when the QR code is scanned very close or exactly at the end of the refresh period, the validation terminal must

. perform regular time synchronization, and
. allow a grace period of up to 5 seconds  and QR issuers must settle transaction with a transaction time that is up to 5 seconds after the end of the refresh period of the accepted QR ticket.

:numbered!:
== Definitions and Acronyms

AFCS:: Automated Fare Collection Service. Service that uses technology to collect fares using a variety of funding and ticketing mechanism.

Clearing:: Process of allocating transactions to entities for Credit or Debit of transaction amounts and creation of settlement reports for each entity containing the transaction details and transaction totals that will be credited or debited to the entities settlement account during settlement.

Inspection Terminal:: Terminal used by ticket inspectors to verify whether a QR ticket is valid

Pre-Paid Ticket:: A ticket that is purchased before the passenger start the trip. the payment mechanism is out of scope for this specification.
+
.Note
****
* The payment for a pre-paid ticket can itself be pre-paid (cash or Debit card) or post-paid (Credit card).
* For a pre-paid ticket the fare amount must be known in advance, for example in cases of fixed fares or when boarding and destination stations are known.
****

Paid Area:: An area of a transport Operator's operation in which only customers with a valid ticket should be present.

Post-Paid Ticket:: A ticket that contains information about the account of the passenger from which the ultimate fare can be deducted.
+
.Note
****
For post-paid tickets the fare amount is usually not known until after the passenger has left the paid area at the destination station.
****

Reconciliation:: Process of multiple parties using independently collected transaction data to verify whether the list of transactions and the transaction totals for a particular time period are complete and accurate

Settlement:: Process of moving funds based on settlement reports created in Clearing.

Unpaid Area:: Any area that is not a Paid Area. Paid Area and Unpaid Area are often separated by automated gates or other access control mechanisms.

Validator:: Short for Validator Terminal

Validator Terminal:: Terminal operated by the QCAT Ticket Acceptor, which checks the QR code and decides whether to let the passenger enter or leave the Paid Area. Validator Terminals can be "Bus Validators" or "Automated Gates" or even handheld inspection terminals.

:numbered!:

[appendix]
== Roles in the QR Ticketing Ecosystem

=== QCAT Ticket Issuer
An entity who enters into a contract with a potential or current passenger, issues QR tickets to the passenger, collects the ticket price from the passenger and settles the ticket price with the QCAT Ticket Acceptor.

=== QCAT Ticket Acceptor
An entity who operates a system that is capable of validating tickets and that settles the ticket price with the respective Transport Operator and the QCAT Ticket Issuer.

=== QCAT Ticket Creator
An entity authorized by the QCAT Ticket Issuer to generate and/or sell QCAT tickets. The liability for the settlement of ticket prices remains with the QCAT Ticket Issuer.  The QCAT Registrar may issue a limited number of additional participant IDs to the QCAT Ticket Issuer to support the allocation of funds between QCAT Ticket Issuer and its QCAT Ticket Creators.

=== Passenger
A person buying and using a ticket for the purpose of using the services of a Public Transport Operator.

=== Public Transport Operator
An entity offering person transport services to the public (including defined groups such as residence of a ho9using estate or an industrial park)

=== QCAT Certificate Authority
An entity signing the Public Keys of QCAT Ticket Issuers, distributing the certificates to QCAT Acceptors and distribute certificate revocation lists to QCAT Acceptors

=== QCAT Registrar
An entity that maintenance a registry of reserved identifiers for use in QCAT tickets.  Examples of reserved identifiers include Ticket Issuer Identifiers and Default Ticket Type Identifiers (e.g. Senior Citizen Ticket Type).


== References

[horizontal]
Ref1 [[emv-qr-spec-consumer]]:: EMV® QR Code Specification for Payment Systems (EMV QRCPS), Consumer-Presented Mode, Version 1.0 July 2017

Ref2 [[emv-qr-spec-merchant]]:: EMV® - QR Code Specification for Payment Systems (EMV QRCPS), Merchant-Presented Mode,  Version 1.0 July 2017

Ref3 [[sample-qr-codes]]:: Sample QCAT QR Codes, Version 0.1
+
Document that contains sample tickets, TLV and Base64 encoded data and corresponding QR codes.

Ref4 [[qr-code-ticketing-key-management]]:: Public Key Management System for Signature Algorithm Version 1 and 2, AF Payments, Ingo Noka, Version 0.5, Aug 8, 2019
+
Document describes the key management practices using the default algorithm 1 (RSA) as an example.

Ref5 [[qr-code-ticketing-settlement]]:: QR Code Standard for Transport Ticketing - Settlement Rules, AF Payments, Ingo Noka, Version 0.5, Aug 8, 2019
+
Document that describes the flow of funds for pre-paid and post-paid tickets

== Copyright
Copyright © 2018 by AF Payments Inc

This work is licensed under the Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License. To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-nd/4.0/ or send a letter to Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.

All rights reserved. This specification or any portion thereof may not be reproduced or used in any manner whatsoever without the express written permission of the Copyright owner.

The Specifications are provided “AS IS” without warranties of any kind, and AF Payments Inc. neither assumes nor accepts any liability for any errors or omissions contained in these Specifications. AF PAYMENTS INC DISCLAIMS ALL REPRESENTATIONS AND WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON- INFRINGEMENT, AS TO THESE SPECIFICATIONS.

AF Payments Inc makes no representations or warranties with respect to intellectual property rights of any third parties in or in relation to the Specifications. AF Payments Inc. undertakes no responsibility to determine whether any implementation of the Specifications may violate, infringe, or otherwise exercise the patent, copyright, trademark, trade secret, know-how, or other intellectual property rights of third parties, and thus any person who implements any part of the Specifications should consult an intellectual property attorney before any such implementation.

Without limiting the foregoing, the Specifications may provide for the use of public key encryption and other technology, which may be the subject matter of patents in several countries. Any party seeking to implement these Specifications is solely responsible for determining whether its activities require a license to any such technology, including for patents on public key encryption technology. AF Payments Inc. shall not be liable under any theory for any party’s infringement of any intellectual property rights in connection with the Specifications.

QR Code is a registered trademark of DENSO WAVE.
